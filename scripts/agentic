#!/bin/bash
# Agentic Planning Coordinator CLI
# This is a shell wrapper that calls the VS Code extension commands
#
# Usage: agentic <command> [args...]
#
# Examples:
#   agentic status
#   agentic plan start --prompt "Implement combo system"
#   agentic coordinator start --plan-session ps_001
#   agentic engineer log --name Alex --lines 50

set -e

# Colors
COLOR_CYAN='\033[0;36m'
COLOR_GREEN='\033[0;32m'
COLOR_YELLOW='\033[0;33m'
COLOR_RED='\033[0;31m'
COLOR_RESET='\033[0m'

# Check if cursor CLI is available
if ! command -v cursor &> /dev/null; then
    echo -e "${COLOR_RED}Error: cursor CLI not found in PATH${COLOR_RESET}"
    echo "Please ensure Cursor is installed and the CLI is available."
    exit 1
fi

# Function to call VS Code extension command
call_extension_command() {
    local command_name="$1"
    shift
    local args="$*"
    
    # Use cursor to execute the extension command
    cursor --command "agenticPlanning.cli" --args "{\"command\": \"$command_name\", \"args\": \"$args\"}" 2>/dev/null
}

# Parse command
COMMAND="${1:-help}"
shift 2>/dev/null || true

case "$COMMAND" in
    status)
        echo -e "${COLOR_CYAN}Agentic Planning Status${COLOR_RESET}"
        call_extension_command "status" "$@"
        ;;
    
    plan)
        SUB_COMMAND="${1:-list}"
        shift 2>/dev/null || true
        call_extension_command "plan $SUB_COMMAND" "$@"
        ;;
    
    coordinator)
        SUB_COMMAND="${1:-list}"
        shift 2>/dev/null || true
        call_extension_command "coordinator $SUB_COMMAND" "$@"
        ;;
    
    pool)
        SUB_COMMAND="${1:-status}"
        shift 2>/dev/null || true
        call_extension_command "pool $SUB_COMMAND" "$@"
        ;;
    
    engineer)
        SUB_COMMAND="${1:-list}"
        shift 2>/dev/null || true
        call_extension_command "engineer $SUB_COMMAND" "$@"
        ;;
    
    unity)
        SUB_COMMAND="${1:-compile}"
        shift 2>/dev/null || true
        call_extension_command "unity $SUB_COMMAND" "$@"
        ;;
    
    help|--help|-h)
        echo -e "${COLOR_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${COLOR_RESET}"
        echo -e "${COLOR_CYAN}â•‘     ğŸ¤– Agentic Planning Coordinator CLI                   â•‘${COLOR_RESET}"
        echo -e "${COLOR_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${COLOR_RESET}"
        echo ""
        echo "Usage: agentic <command> [subcommand] [options]"
        echo ""
        echo "Commands:"
        echo "  status                          Show overall status"
        echo ""
        echo "  plan list                       List all planning sessions"
        echo "  plan start --prompt \"...\"       Start new planning session"
        echo "  plan status --id <id>           Get planning session status"
        echo "  plan revise --id <id> --feedback \"...\"  Revise a plan"
        echo "  plan approve --id <id>          Approve a plan for execution"
        echo "  plan cancel --id <id>           Cancel a planning session"
        echo ""
        echo "  coordinator list                List all coordinators"
        echo "  coordinator start --plan <path> [--mode auto|interactive] [--engineers <n>]"
        echo "  coordinator status --id <id>    Get coordinator status"
        echo "  coordinator pause --id <id>     Pause a coordinator"
        echo "  coordinator resume --id <id>    Resume a coordinator"
        echo "  coordinator stop --id <id>      Stop a coordinator"
        echo ""
        echo "  pool status                     Show engineer pool status"
        echo "  pool resize --size <n>          Resize engineer pool"
        echo ""
        echo "  engineer list                   List all engineers"
        echo "  engineer status --name <name>   Get engineer status"
        echo "  engineer log --name <name> [--lines <n>]  Read engineer log"
        echo "  engineer terminal --name <name> Open engineer terminal"
        echo "  engineer stop --name <name>     Stop an engineer"
        echo "  engineer pause --name <name>    Pause an engineer"
        echo "  engineer resume --name <name>   Resume an engineer"
        echo ""
        echo "  unity compile                   Check Unity compilation"
        echo "  unity test [--scene <path>]     Run Unity playmode test"
        echo "  unity console                   Read Unity console"
        echo ""
        echo "  help                            Show this help message"
        echo ""
        ;;
    
    *)
        echo -e "${COLOR_RED}Unknown command: $COMMAND${COLOR_RESET}"
        echo "Use 'agentic help' for available commands."
        exit 1
        ;;
esac

